<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Taaza - Cancel Subscription</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;700;900&amp;display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <style type="text/tailwindcss">
        :root {
            --zepto-blue: #0C2D57;
            --zepto-yellow: #FFD700;
            --zepto-light-bg: #F8F4E9;
            --zepto-manage-blue: #4A7B9D;
            --zepto-order-red: #D5715C;
            --zepto-green: #10B981;
            --zepto-gray: #6B7280;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--zepto-light-bg);
        }
        
        .material-symbols-outlined {
            font-variation-settings:
            'FILL' 0,
            'wght' 400,
            'GRAD' 0,
            'opsz' 24
        }
        
        /* Custom animations */
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from { transform: translateY(10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* Enhanced responsive breakpoints */
        @media (max-width: 374px) {
            .p-4 {
                padding: 0.75rem;
            }
            
            .space-y-6 > * + * {
                margin-top: 1rem;
            }
            
            .space-y-3 > * + * {
                margin-top: 0.5rem;
            }
            
            .text-lg {
                font-size: 1rem;
            }
        }
        
        @media (min-width: 375px) and (max-width: 639px) {
            .container {
                padding-left: 1rem;
                padding-right: 1rem;
            }
        }
        
        @media (min-width: 768px) {
            .space-y-6 > * + * {
                margin-top: 2rem;
            }
            
            .max-w-400px {
                max-width: 500px;
            }
        }
        
        /* Safe area for notched phones */
        .h-safe-area-bottom {
            height: constant(safe-area-inset-bottom);
            height: env(safe-area-inset-bottom);
        }
        
        @supports (padding: max(0px)) {
            .sticky {
                padding-left: max(1rem, env(safe-area-inset-left));
                padding-right: max(1rem, env(safe-area-inset-right));
                padding-bottom: max(1rem, env(safe-area-inset-bottom));
            }
        }
        
        /* Enhanced radio button styling */
        .custom-radio:checked + .radio-content {
            border-color: var(--zepto-manage-blue);
            background-color: rgba(74, 123, 157, 0.1);
        }
        
        .custom-radio:checked + .radio-content .radio-dot {
            background-color: var(--zepto-manage-blue);
            border-color: var(--zepto-manage-blue);
        }
        
        /* Enhanced touch targets */
        .radio-content {
            min-height: 56px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .radio-content:hover {
            background-color: rgba(74, 123, 157, 0.05);
            transform: translateY(-1px);
        }
        
        .radio-content:active {
            transform: scale(0.98);
        }
        
        .radio-dot {
            min-width: 20px;
            min-height: 20px;
            width: 20px;
            height: 20px;
        }
        
        /* Focus indicators */
        .custom-radio:focus-visible + .radio-content {
            outline: 2px solid #FFD700;
            outline-offset: 2px;
        }
        
        /* Custom styling for form elements */
        .form-radio:checked {
            background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='%23ffffff' xmlns='http://www.w3.org/2000/svg'%3e%3ccircle cx='8' cy='8' r='3'/%3e%3c/svg%3e");
            border-color: transparent;
            background-color: var(--zepto-blue);
        }
        
        /* Popup overlay */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        
        .popup-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        /* Popup content */
        .popup-content {
            background-color: white;
            border-radius: 16px;
            width: 90%;
            max-width: 400px;
            transform: translateY(20px);
            opacity: 0;
            transition: transform 0.3s, opacity 0.3s;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .popup-overlay.active .popup-content {
            transform: translateY(0);
            opacity: 1;
        }
        
        /* Popup animation */
        @keyframes popupIn {
            from {
                transform: scale(0.9);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }
    </style>
</head>

<body class="text-gray-800">
    <div class="flex flex-col min-h-screen font-display">
        <!-- Header -->
        <header class="bg-[var(--zepto-blue)] text-white p-4 sticky top-0 z-20 shadow-md">
            <div class="container mx-auto flex items-center justify-between">
                <button class="text-white focus-visible:focus rounded-lg p-2 hover:bg-blue-900 transition-colors"
                    onclick="goBack()" aria-label="Go back">
                    <span class="material-symbols-outlined">arrow_back</span>
                </button>
                <h1 class="text-lg font-bold">Cancel Subscription</h1>
                <div class="w-8"></div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-grow p-4 space-y-6 slide-up">
            <!-- Current Plan Summary -->
            <section class="bg-white/80 backdrop-blur-sm rounded-xl p-4 shadow-sm border border-white/50">
                <div class="flex items-center gap-4">
                    <div
                        class="h-16 w-16 shrink-0 rounded-lg bg-cover bg-center flex items-center justify-center bg-[var(--zepto-light-bg)]">
                        <span class="material-symbols-outlined text-3xl text-[var(--zepto-blue)]">local_drink</span>
                    </div>
                    <div class="flex flex-col">
                        <p class="text-sm text-gray-600">Current Subscription</p>
                        <p id="current-plan" class="font-bold text-gray-800">Loading...</p>
                    </div>
                </div>
            </section>

            <!-- Reason for Cancellation -->
            <section class="space-y-3">
                <h2 class="text-lg font-semibold text-gray-800">Reason for Cancellation</h2>
                <div class="space-y-3">
                    <label
                        class="flex items-center gap-4 rounded-lg border border-gray-300 bg-white p-4 cursor-pointer transition-all">
                        <input class="sr-only custom-radio" name="cancellation_reason" type="radio" value="moving"
                            checked />
                        <span class="flex-grow text-base font-medium text-gray-800">Moving out of service area</span>
                        <span
                            class="radio-dot h-5 w-5 rounded-full border-2 border-gray-300 flex items-center justify-center">
                            <span class="h-2 w-2 rounded-full bg-transparent"></span>
                        </span>
                    </label>

                    <label
                        class="flex items-center gap-4 rounded-lg border border-gray-300 bg-white p-4 cursor-pointer transition-all">
                        <input class="sr-only custom-radio" name="cancellation_reason" type="radio" value="expensive" />
                        <span class="flex-grow text-base font-medium text-gray-800">Too expensive</span>
                        <span
                            class="radio-dot h-5 w-5 rounded-full border-2 border-gray-300 flex items-center justify-center">
                            <span class="h-2 w-2 rounded-full bg-transparent"></span>
                        </span>
                    </label>

                    <label
                        class="flex items-center gap-4 rounded-lg border border-gray-300 bg-white p-4 cursor-pointer transition-all">
                        <input class="sr-only custom-radio" name="cancellation_reason" type="radio"
                            value="not_needed" />
                        <span class="flex-grow text-base font-medium text-gray-800">Don't need it anymore</span>
                        <span
                            class="radio-dot h-5 w-5 rounded-full border-2 border-gray-300 flex items-center justify-center">
                            <span class="h-2 w-2 rounded-full bg-transparent"></span>
                        </span>
                    </label>

                    <label
                        class="flex items-center gap-4 rounded-lg border border-gray-300 bg-white p-4 cursor-pointer transition-all">
                        <input class="sr-only custom-radio" name="cancellation_reason" type="radio" value="other" />
                        <span class="flex-grow text-base font-medium text-gray-800">Other</span>
                        <span
                            class="radio-dot h-5 w-5 rounded-full border-2 border-gray-300 flex items-center justify-center">
                            <span class="h-2 w-2 rounded-full bg-transparent"></span>
                        </span>
                    </label>
                </div>
            </section>

            <!-- Additional Comments -->
            <section class="space-y-3">
                <h2 class="text-lg font-semibold text-gray-800">Additional Comments (Optional)</h2>
                <textarea
                    class="w-full resize-none rounded-lg border border-gray-300 bg-white p-4 text-base text-gray-800 placeholder-gray-400 focus:border-[var(--zepto-manage-blue)] focus:ring-1 focus:ring-[var(--zepto-manage-blue)]"
                    placeholder="Please share any additional feedback..." rows="4"></textarea>
            </section>

            <!-- Cancellation Notice -->
            <section class="rounded-lg bg-[var(--zepto-manage-blue)]/10 p-4 text-center">
                <p class="text-sm text-[var(--zepto-blue)] font-medium">
                    Your deliveries will stop from <span id="stop-date" class="font-bold">tomorrow.</span>
                </p>
            </section>
        </main>

        <!-- Footer with Action Buttons -->
        <footer class="p-4 bg-white/80 backdrop-blur-sm sticky bottom-0 border-t border-gray-200">
            <div class="space-y-3">
                <button onclick="showConfirmationPopup()"
                    class="w-full min-h-[48px] h-14 bg-[var(--zepto-order-red)] text-white font-bold text-lg rounded-lg shadow-lg hover:bg-red-600 transition-all duration-200 flex items-center justify-center gap-2 focus-visible:outline-2 focus-visible:outline-yellow-400 focus-visible:outline-offset-2" aria-label="Confirm subscription cancellation">
                    Confirm Cancellation
                </button>
                <button onclick="keepSubscription()"
                    class="w-full min-h-[48px] h-14 bg-gray-200 text-gray-800 font-bold text-lg rounded-lg hover:bg-gray-300 transition-all duration-200 flex items-center justify-center gap-2 focus-visible:outline-2 focus-visible:outline-yellow-400 focus-visible:outline-offset-2" aria-label="Keep your subscription active">
                    Keep Subscription
                </button>
            </div>
        </footer>
    </div>

    <!-- Confirmation Popup -->
    <div id="confirmationPopup" class="popup-overlay">
        <div class="popup-content">
            <div class="p-6">
                <!-- Popup Header -->
                <div class="flex items-center mb-4">
                    <div class="h-12 w-12 rounded-full bg-red-100 flex items-center justify-center mr-3">
                        <span class="material-symbols-outlined text-red-500 text-2xl">warning</span>
                    </div>
                    <h2 class="text-xl font-bold text-gray-800">Confirm Cancellation</h2>
                </div>

                <!-- Popup Content -->
                <div class="mb-6">
                    <p class="text-gray-600 mb-4">Are you sure you want to cancel your subscription?</p>

                    <div class="bg-gray-50 rounded-lg p-4 mb-4">
                        <div class="flex justify-between mb-2">
                            <span class="text-gray-600">Plan:</span>
                            <span id="popup-plan" class="font-medium">Loading...</span>
                        </div>
                        <div class="flex justify-between mb-2">
                            <span class="text-gray-600">Last Delivery:</span>
                            <span id="popup-last-delivery" class="font-medium">Tomorrow</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Reason:</span>
                            <span id="popupReason" class="font-medium">Moving out of service area</span>
                        </div>
                    </div>

                    <p class="text-sm text-gray-500">You can always resubscribe later if you change your mind.</p>
                </div>

                <!-- Popup Actions -->
                <div class="flex space-x-3">
                    <button onclick="hideConfirmationPopup()"
                        class="flex-1 h-12 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300 transition-colors">
                        Go Back
                    </button>
                    <button onclick="processCancellation()"
                        class="flex-1 h-12 bg-[var(--zepto-order-red)] text-white font-medium rounded-lg hover:bg-red-600 transition-colors">
                        Yes, Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Navigation functions
        function goBack() {
            window.history.back();
        }

        // Show confirmation popup
        function showConfirmationPopup() {
            const reason = document.querySelector('input[name="cancellation_reason"]:checked').value;
            const reasonText = document.querySelector(`input[value="${reason}"]`).closest('label').querySelector('span').textContent;

            // Update the popup with the selected reason and plan data
            document.getElementById('popupReason').textContent = reasonText;
            document.getElementById('popup-plan').textContent = window.subscriptionData.plan;
            document.getElementById('popup-last-delivery').textContent = window.subscriptionData.stopDate;

            // Show the popup
            document.getElementById('confirmationPopup').classList.add('active');
        }

        // Hide confirmation popup
        function hideConfirmationPopup() {
            document.getElementById('confirmationPopup').classList.remove('active');
        }

        // Process cancellation after confirmation
        function processCancellation() {
            const reason = document.querySelector('input[name="cancellation_reason"]:checked').value;
            const comments = document.querySelector('textarea').value;

            // Hide the popup
            hideConfirmationPopup();

            // Show confirmation message
            showToast("Cancelled ✓");

            // Redirect to homepage after a delay
            setTimeout(() => {
                window.location.href = 'Subscription Canceled page.html';
            }, 2000);
        }

        // Keep subscription
        function keepSubscription() {
            // Redirect back to milk plan page
            window.location.href = 'Your Milk Plan.html';
        }

        // Show toast notification
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed top-6 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => {
                document.body.removeChild(toast);
            }, 1800);
        }

        // Get formatted date
        function getFormattedDate(daysFromNow = 0) {
            const date = new Date();
            date.setDate(date.getDate() + daysFromNow);
            return date.toLocaleDateString('en-IN', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }

        // Load subscription data
        function loadSubscriptionData() {
            const morningEnabled = localStorage.getItem('morningDelivery') === 'true';
            const eveningEnabled = localStorage.getItem('eveningDelivery') === 'true';
            
            let planText = '';
            let timeSlotText = '';
            
            if (morningEnabled && eveningEnabled) {
                const morningQty = localStorage.getItem('morningQuantity') || '0.5';
                const morningType = localStorage.getItem('morningMilkType') || 'buffalo';
                const eveningQty = localStorage.getItem('eveningQuantity') || '0.5';
                const eveningType = localStorage.getItem('eveningMilkType') || 'cow';
                const morningTimeSlot = localStorage.getItem('morningTimeSlot') || '7:00-7:30';
                const eveningTimeSlot = localStorage.getItem('eveningTimeSlot') || '6:00-6:30';
                
                planText = `Morning: ${morningQty}L ${morningType === 'buffalo' ? 'Buffalo' : 'Cow'} + Evening: ${eveningQty}L ${eveningType === 'buffalo' ? 'Buffalo' : 'Cow'}`;
                timeSlotText = `Morning: ${morningTimeSlot.replace('-', ' - ')} AM, Evening: ${eveningTimeSlot.replace('-', ' - ')} PM`;
            } else if (morningEnabled) {
                const qty = localStorage.getItem('morningQuantity') || '0.5';
                const type = localStorage.getItem('morningMilkType') || 'buffalo';
                const freq = localStorage.getItem('morningFrequency') || 'daily';
                const timeSlot = localStorage.getItem('morningTimeSlot') || '7:00-7:30';
                planText = `${qty}L ${type === 'buffalo' ? 'Buffalo' : 'Cow'} Milk - ${freq === 'daily' ? 'Daily' : 'Alternate Days'} (Morning)`;
                timeSlotText = `${timeSlot.replace('-', ' - ')} AM`;
            } else if (eveningEnabled) {
                const qty = localStorage.getItem('eveningQuantity') || '0.5';
                const type = localStorage.getItem('eveningMilkType') || 'cow';
                const freq = localStorage.getItem('eveningFrequency') || 'alternate';
                const timeSlot = localStorage.getItem('eveningTimeSlot') || '6:00-6:30';
                planText = `${qty}L ${type === 'buffalo' ? 'Buffalo' : 'Cow'} Milk - ${freq === 'daily' ? 'Daily' : 'Alternate Days'} (Evening)`;
                timeSlotText = `${timeSlot.replace('-', ' - ')} PM`;
            } else {
                planText = 'No active subscription';
                timeSlotText = 'N/A';
            }
            
            document.getElementById('current-plan').textContent = planText;
            
            // Set stop date (tomorrow)
            const stopDate = getFormattedDate(1);
            document.getElementById('stop-date').textContent = stopDate;
            
            // Store for popup use
            window.subscriptionData = {
                plan: planText,
                timeSlot: timeSlotText,
                stopDate: stopDate
            };
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function () {
            // Load subscription data
            loadSubscriptionData();
            // Add event listeners to all radio buttons
            const radioButtons = document.querySelectorAll('input[type="radio"]');
            radioButtons.forEach(radio => {
                radio.addEventListener('change', function () {
                    // Update the visual state of all radio buttons
                    radioButtons.forEach(r => {
                        const label = r.closest('label');
                        const dot = label.querySelector('.radio-dot');
                        if (r.checked) {
                            label.classList.add('border-[var(--zepto-manage-blue)]', 'bg-[var(--zepto-manage-blue)]/10');
                            dot.classList.add('bg-[var(--zepto-manage-blue)]', 'border-[var(--zepto-manage-blue)]');
                        } else {
                            label.classList.remove('border-[var(--zepto-manage-blue)]', 'bg-[var(--zepto-manage-blue)]/10');
                            dot.classList.remove('bg-[var(--zepto-manage-blue)]', 'border-[var(--zepto-manage-blue)]');
                        }
                    });
                });
            });

            // Initialize the radio button states
            radioButtons.forEach(radio => {
                if (radio.checked) {
                    const label = radio.closest('label');
                    const dot = label.querySelector('.radio-dot');
                    label.classList.add('border-[var(--zepto-manage-blue)]', 'bg-[var(--zepto-manage-blue)]/10');
                    dot.classList.add('bg-[var(--zepto-manage-blue)]', 'border-[var(--zepto-manage-blue)]');
                }
            });
        });
    </script>
</body>

</html>